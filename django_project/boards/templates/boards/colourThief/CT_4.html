{% load custom_tags %}

<!DOCTYPE html>
<html>
<head>
	<title></title>

	<meta charset="UTF-8">

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" media="screen">
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.10/clipboard.min.js"></script>

	<link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,600,700&display=swap" rel="stylesheet">

	<script src="https://code.iconify.design/1/1.0.5/iconify.min.js"></script>

	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">

	<style type="text/css">
		body{
			font-family: 'Quicksand', sans-serif;
		}

		.container {
			color: white;
		}

		h1 {
			font-weight: 700;
			color: lightgrey;
		}

		.jumbotron {
			background-image: url("https://images.unsplash.com/photo-1503682579489-1a53aff795af?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80");
			background-size: cover;
			background-position: 0;
			/*height: 30rem;*/
			padding-top: 10rem;
			opacity: 85%;
			background-blend-mode: multiply;
		}

		.btn.nohover:hover {
			cursor:default !important;
		}

		.saving{
			font-weight: bold;
			font-style: italic;
			background: #f48fb1;
		}

		.counting {
			font-weight: bold;
			background: #4dd0e1;
		}

		button {
			margin-left: 0.5em;
		}

		.dropdown-item:active {
			background-color: #5bc0de;
		}

		nav {
			/*margin-bottom: 2rem;*/
		}

		hr {
			border-top: 1px solid white;
		}

		input[type="text"], textarea {
			outline: none;
			box-shadow:none !important;
			border:1px solid #ccc !important;
		}

	</style>

	<style type="text/css">
		
		.grid {
			margin: 2rem;
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
			grid-gap: 1rem;
		}

		.polaroid {
			background: #ededed;
			padding: 1rem;
			display: grid;
			border-radius: 6px;
		}

		.polaroid-square {
			display: grid;
		}

		.polaroid-square::before {
			content: '';
			display: block;
			padding-top: 100%;
			grid-area: 1 / 1 / 2 / 2;
		}

		.contain {
			position: relative;
			height: 100%;
			width: 100%;
			object-fit: cover;
			grid-area: 1 / 1 / 2 / 2;
		}

		.contain::before {
			grid-area: 1 / 1 / 2 / 2;
		}

		.photo {
			width: 100%;
			height: 100%;
			max-height: 100%;
			object-fit: cover;
			grid-area: 1 / 1 / 2 / 2;
		}

		.photo:hover {
			/*color: black;*/
			/*background: black;*/
			/*opacity: 0.2;*/
			/*position: relative;*/
			/*background-blend-mode: multiply;*/

			-webkit-filter: brightness(50%);
			-webkit-transition: all 0.5s ease;
			-moz-transition: all 0.5s ease;
			-o-transition: all 0.5s ease;
			-ms-transition: all 0.5s ease;
			transition: all 0.5s ease;
		}

		.colour-palette {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(20%, 1fr));
		}

		.spacer {
			content: "";
			padding-top: 1rem;
		}

		.square {
			display: grid;
		}

		.square::before {
			content: "";
			padding-top: 100%;
			display: block;
		}

		.img-rounded {
			width: 2.5rem;
			height: 2.5rem;
			/*clip-path: circle(60px at center);*/
			border-radius: 3px;
			-webkit-border-radius: 3px;
			-moz-border-radius: 3px;
		}

		.top-left {
			position: absolute;
			top: 10px;
			left: 10px;
		}

		.middle > * {
			vertical-align: middle;
			display: inline-block;
		}

		.bottom-left {
			position: absolute;
			bottom: 10px;
			left: 10px;
		}

		.contain .hoverOnly{
			opacity: 0;
			visibility: hidden;
			-webkit-transition: opacity 600ms, visibility 600ms;
			transition: opacity 600ms, visibility 600ms;
		}

		.contain:hover .hoverOnly{
			visibility: visible;
			opacity: 1;
		}

		.noselect {
			-moz-user-select: none;
			-khtml-user-select: none;
			-webkit-user-select: none;
		}

		.disabled {
			pointer-events: none;
		}

		.navbar {
			position:fixed;
			width:100%;
			z-index: 1000000;
			top:0;
		}

	</style>
</head>
<body onload="checkImageLoad();">

	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		
		<div class="collapse navbar-collapse noselect" id="navbarSupportedContent">
		
			<ul class="navbar-nav mr-auto">

				{% for header in context.tab_headers %}

				<li class="nav-item">
					<a class="nav-link" href="{% url 'boards:boards-searchTabImages' header %}">{{ header }}</a>
				</li>

				{% endfor %}

			</ul>

		</div>
	</nav>

	<div class="jumbotron jumbotron-fluid bg-dark noselect">
		<div class="container">
			<h1 class="display-4 text-white">Pal<span>&#233;</span>tte</h1>
			<p class="lead">Moodboard tool to help you search for your next vibe.</p>

			<form action="{% url 'boards:boards-searchImages' %}" method="GET">
				<div class="form-row">

					<div class="col-12">
						<div class="input-group mb-2">
							<div class="input-group-prepend">
								<div class="input-group-text"><span class="iconify" data-icon="ion:search" data-inline="false"></span></div>
							</div>
							<input name="query" type="text" class="form-control" id="myHideInput" onkeyup="myHideFilter()" placeholder="Search.." value="{{request.GET.query}}">
						</div>
					</div>

				</div>
			</form>
		</div>
	</div>

	{% if context.Error == False %}

		<div class="grid">

			{% for unsplash in context.unsplash_data %}

				<div class="polaroid">
					<div class="polaroid-square">
							<div class="contain">
								<img class="photo" src={{ unsplash.urls.regular }} crossorigin="anonymous">
								<div class="top-left hoverOnly noselect disabled">
									<img src={{ unsplash.user.profile_image.medium }} class="img-rounded" alt={{ unsplash.user.username }} crossorigin="anonymous">
									<a href={{ unsplash.user.links.self }} style="color: white;">{{ unsplash.user.first_name }} {{ unsplash.user.last_name }}</a>
								</div>
								<div class="bottom-left hoverOnly noselect disabled">
									{% if unsplash.user.location != None %}
										<i style="color: white;" class="fas fa-map-marker-alt"></i>
										<div style="color: white;">{{ unsplash.user.location }}</div>
									{% endif %}
								</div>
							</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<a class="ttip" data-toggle="tooltip" data-placement="bottom" title="Hooray!" id='tooltip-{{ forloop.counter0 }}0'>
								<div class="square" id='{{ forloop.counter0 }}0'+ style="background: #ededed; border-radius: 0px 0px 0px 3px;" ></div>
							</a>
							<a class="ttip" data-toggle="tooltip" data-placement="bottom" title="Hooray!" id='tooltip-{{ forloop.counter0 }}1'>
								<div class="square" id='{{ forloop.counter0 }}1'+ style="background: #ededed;"></div>
							</a>
							<a class="ttip" data-toggle="tooltip" data-placement="bottom" title="Hooray!" id='tooltip-{{ forloop.counter0 }}2'>
								<div class="square" id='{{ forloop.counter0 }}2'+ style="background: #ededed;"></div>
							</a>
							<a class="ttip" data-toggle="tooltip" data-placement="bottom" title="Hooray!" id='tooltip-{{ forloop.counter0 }}3'>
								<div class="square" id='{{ forloop.counter0 }}3'+ style="background: #ededed;"></div>
							</a>
							<a class="ttip" data-toggle="tooltip" data-placement="bottom" title="Hooray!" id='tooltip-{{ forloop.counter0 }}4'>
								<div class="square" id='{{ forloop.counter0 }}4'+ style="background: #ededed; border-radius: 0px 0px 3px 0px;"></div>
							</a>
						</div>
					</div>
				</div>

			{% endfor %}

		</div>

	{% else %}

		{% if context.query == "random" %}

			<div class="grid">

				<div class="polaroid">
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<div class="square" id=00 style="background: #ededed;"></div>
							<div class="square" id=01 style="background: #ededed;"></div>
							<div class="square" id=02 style="background: #ededed;"></div>
							<div class="square" id=03 style="background: #ededed;"></div>
							<div class="square" id=04 style="background: #ededed;"></div>
						</div>
					</div>
				</div>
				<div class="polaroid" id=1>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/test" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<div class="square" id=10 style="background: #ededed;"></div>
							<div class="square" id=11 style="background: #ededed;"></div>
							<div class="square" id=12 style="background: #ededed;"></div>
							<div class="square" id=13 style="background: #ededed;"></div>
							<div class="square" id=14 style="background: #ededed;"></div>
						</div>				
					</div>
				</div>
				<div class="polaroid" id=2>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/123" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>					
						<div class="colour-palette">
							<div class="square" id=20 style="background: #ededed;"></div>
							<div class="square" id=21 style="background: #ededed;"></div>
							<div class="square" id=22 style="background: #ededed;"></div>
							<div class="square" id=23 style="background: #ededed;"></div>
							<div class="square" id=24 style="background: #ededed;"></div>
						</div>
					</div>
				</div>
				<div class="polaroid" id=3>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/hello" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>					
						<div class="colour-palette">
							<div class="square" id=30 style="background: #ededed;"></div>
							<div class="square" id=31 style="background: #ededed;"></div>
							<div class="square" id=32 style="background: #ededed;"></div>
							<div class="square" id=33 style="background: #ededed;"></div>
							<div class="square" id=34 style="background: #ededed;"></div>
						</div>
					</div>
				</div>
				<div class="polaroid" id=4>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/key" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<div class="square" id=40 style="background: #ededed;"></div>
							<div class="square" id=41 style="background: #ededed;"></div>
							<div class="square" id=42 style="background: #ededed;"></div>
							<div class="square" id=43 style="background: #ededed;"></div>
							<div class="square" id=44 style="background: #ededed;"></div>
						</div>
					</div>
				</div>
				<div class="polaroid" id=4>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/orange" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<div class="square" id=50 style="background: #ededed;"></div>
							<div class="square" id=51 style="background: #ededed;"></div>
							<div class="square" id=52 style="background: #ededed;"></div>
							<div class="square" id=53 style="background: #ededed;"></div>
							<div class="square" id=54 style="background: #ededed;"></div>
						</div>
					</div>
				</div>
				<div class="polaroid" id=4>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/play" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<div class="square" id=60 style="background: #ededed;"></div>
							<div class="square" id=61 style="background: #ededed;"></div>
							<div class="square" id=62 style="background: #ededed;"></div>
							<div class="square" id=63 style="background: #ededed;"></div>
							<div class="square" id=64 style="background: #ededed;"></div>
						</div>
					</div>
				</div>
				<div class="polaroid" id=4>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/tred" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<div class="square" id=70 style="background: #ededed;"></div>
							<div class="square" id=71 style="background: #ededed;"></div>
							<div class="square" id=72 style="background: #ededed;"></div>
							<div class="square" id=73 style="background: #ededed;"></div>
							<div class="square" id=74 style="background: #ededed;"></div>
						</div>
					</div>
				</div>
				<div class="polaroid" id=4>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/plo" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<div class="square" id=80 style="background: #ededed;"></div>
							<div class="square" id=81 style="background: #ededed;"></div>
							<div class="square" id=82 style="background: #ededed;"></div>
							<div class="square" id=83 style="background: #ededed;"></div>
							<div class="square" id=84 style="background: #ededed;"></div>
						</div>
					</div>
				</div>
				<div class="polaroid" id=4>
					<div class="polaroid-square">
						<div class="contain">
							<img class="photo" src="https://source.unsplash.com/random/lol" crossorigin="anonymous">
						</div>
						<div class="spacer"></div>
						<div class="colour-palette">
							<div class="square" id=90 style="background: #ededed;"></div>
							<div class="square" id=91 style="background: #ededed;"></div>
							<div class="square" id=92 style="background: #ededed;"></div>
							<div class="square" id=93 style="background: #ededed;"></div>
							<div class="square" id=94 style="background: #ededed;"></div>
						</div>
					</div>
				</div>

			</div>

		{% else %}



			<div style="font-size: 2rem; text-align: center;"><b>Sorry!</b> We couldn't find any colour pal<span>&#233;</span>ttes for {{context.query}}
			</div>

		{% endif %}

	{% endif %}



	

	<script type="text/javascript">

		function myHideFilter() {
			var input = document.getElementById("myHideInput");
			var filter = input.value;
			// console.log(filter)
		}

		// Tooltip copy to clipboard

		function getTooltipVal(a) {
			var value = $(a).tooltip().attr('data-clipboard-text')
			return value
		}

		function setTooltip(a, message, prev) {

			$(a).tooltip('hide')
			.attr('data-original-title', message)
			.tooltip('show');

			setTimeout(function(){ 
				$(a).tooltip().attr('data-original-title', prev)
			}, 1000);
		}
		
		function hideTooltip(a) {
			setTimeout(function() {
			$(a).tooltip('hide');
			}, 1000);
		}

		var clipboard = new Clipboard('a')

		clipboard.on('success', function(e) {
			var val = getTooltipVal(e.trigger)
			setTooltip(e.trigger, 'Copied!', val);
			hideTooltip(e.trigger);
		});

		clipboard.on('error', function(e) {
			setTooltip(e.trigger, 'Failed!');
			hideTooltip(e.trigger);
		});

		// Create colour palette

		var rgbToHex = function (rgb) { 
			var hex = Number(rgb).toString(16);
			if (hex.length < 2) {
				hex = "0" + hex;
			}
			return hex;
		};

		var fullColorHex = function(r,g,b) {   
			var red = rgbToHex(r);
			var green = rgbToHex(g);
			var blue = rgbToHex(b);
			return red+green+blue;
		};

		function checkImageLoad() {

			const colorThief = new ColorThief();

			const img = document.querySelectorAll('.photo');

			img_palette_arr = []

			for (var i = 0; i < img.length; i ++) {

				var palette_arr = []

				colorThief.getColor(img[i]);

				var color = colorThief.getPalette(img[i], 5);

				for (var col = 0; col < color.length; col ++) {
					var palette_col = 'rgb(' + color[col] + ')'
					$('#' + i + col).css('background', palette_col);
					$('#tooltip-' + i + col).attr('data-original-title', "#" + fullColorHex(color[col][0], color[col][1], color[col][2]))
					$('#tooltip-' + i + col).attr('data-clipboard-text', "#" + fullColorHex(color[col][0], color[col][1], color[col][2]))
				}

			}

		}

		$(document).ready(function(){
			$('[data-toggle="tooltip"]').tooltip();

			// console.log($('#myHideInput')[0].value)
			$('#myHideInput')[0].value = ""
		});

	</script>
</body>
</html>